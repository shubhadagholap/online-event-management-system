<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Management System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        .event-card {
            transition: transform 0.2s;
            height: 100%;
        }
        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
            margin-bottom: 40px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React, ReactDOM, Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;

        // API Configuration
        const API_URL = 'http://localhost:5000/api';

        // Auth Context
        const AuthContext = createContext();

        const AuthProvider = ({ children }) => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const token = localStorage.getItem('token');
                const userData = localStorage.getItem('user');
                if (token && userData) {
                    setUser(JSON.parse(userData));
                }
                setLoading(false);
            }, []);

            const login = async (email, password) => {
                const response = await axios.post(`${API_URL}/auth/login`, { email, password });
                const { token, user } = response.data;
                localStorage.setItem('token', token);
                localStorage.setItem('user', JSON.stringify(user));
                setUser(user);
                return response.data;
            };

            const logout = () => {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                setUser(null);
            };

            return (
                <AuthContext.Provider value={{ user, login, logout, loading }}>
                    {children}
                </AuthContext.Provider>
            );
        };

        // Navbar Component
        const Navbar = () => {
            const { user, logout } = useContext(AuthContext);

            return (
                <nav className="navbar navbar-expand-lg navbar-dark bg-dark">
                    <div className="container">
                        <a className="navbar-brand" href="#home">Event Management</a>
                        <button className="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                            <span className="navbar-toggler-icon"></span>
                        </button>
                        <div className="collapse navbar-collapse" id="navbarNav">
                            <ul className="navbar-nav me-auto">
                                <li className="nav-item">
                                    <a className="nav-link" href="#home">Home</a>
                                </li>
                                <li className="nav-item">
                                    <a className="nav-link" href="#events">Events</a>
                                </li>
                            </ul>
                            <ul className="navbar-nav">
                                {user ? (
                                    <>
                                        <li className="nav-item">
                                            <span className="nav-link">Welcome, {user.name}</span>
                                        </li>
                                        <li className="nav-item">
                                            <button className="btn btn-outline-light btn-sm" onClick={logout}>
                                                Logout
                                            </button>
                                        </li>
                                    </>
                                ) : (
                                    <>
                                        <li className="nav-item">
                                            <a className="nav-link" href="#login">Login</a>
                                        </li>
                                        <li className="nav-item">
                                            <a className="nav-link" href="#register">Register</a>
                                        </li>
                                    </>
                                )}
                            </ul>
                        </div>
                    </div>
                </nav>
            );
        };

        // Home Component
        const Home = () => {
            const [events, setEvents] = useState([]);

            useEffect(() => {
                fetchEvents();
            }, []);

            const fetchEvents = async () => {
                try {
                    const response = await axios.get(`${API_URL}/events`);
                    setEvents(response.data.slice(0, 6));
                } catch (error) {
                    console.error('Error fetching events:', error);
                }
            };

            return (
                <>
                    <div className="hero-section text-center">
                        <div className="container">
                            <h1 className="display-4 mb-4">Welcome to Event Management</h1>
                            <p className="lead mb-4">Discover and book amazing events happening around you</p>
                            <button className="btn btn-light btn-lg">Browse All Events</button>
                        </div>
                    </div>

                    <div className="container mb-5">
                        <h2 className="mb-4">Upcoming Events</h2>
                        <div className="row">
                            {events.map((event) => (
                                <div key={event.id} className="col-md-6 col-lg-4 mb-4">
                                    <div className="card event-card">
                                        <img 
                                            src={event.image_url || 'https://via.placeholder.com/300x200?text=Event'} 
                                            className="card-img-top" 
                                            alt={event.title}
                                            style={{height: '200px', objectFit: 'cover'}}
                                        />
                                        <div className="card-body">
                                            <h5 className="card-title">{event.title}</h5>
                                            <p className="card-text text-muted small">
                                                {new Date(event.date).toLocaleDateString()}
                                            </p>
                                            <p className="card-text">{event.description?.substring(0, 100)}...</p>
                                            <div className="d-flex justify-content-between align-items-center">
                                                <span className="h5 mb-0 text-primary">${event.price}</span>
                                                <button className="btn btn-primary btn-sm">View Details</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </>
            );
        };

        // Login Component
        const Login = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const { login } = useContext(AuthContext);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    await login(email, password);
                    onLogin();
                } catch (err) {
                    setError(err.response?.data?.message || 'Login failed');
                }
            };

            return (
                <div className="container mt-5">
                    <div className="row justify-content-center">
                        <div className="col-md-6">
                            <div className="card">
                                <div className="card-body">
                                    <h2 className="text-center mb-4">Login</h2>
                                    {error && <div className="alert alert-danger">{error}</div>}
                                    <form onSubmit={handleSubmit}>
                                        <div className="mb-3">
                                            <label className="form-label">Email</label>
                                            <input
                                                type="email"
                                                className="form-control"
                                                value={email}
                                                onChange={(e) => setEmail(e.target.value)}
                                                required
                                            />
                                        </div>
                                        <div className="mb-3">
                                            <label className="form-label">Password</label>
                                            <input
                                                type="password"
                                                className="form-control"
                                                value={password}
                                                onChange={(e) => setPassword(e.target.value)}
                                                required
                                            />
                                        </div>
                                        <button type="submit" className="btn btn-primary w-100">Login</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');

            return (
                <AuthProvider>
                    <Navbar />
                    {currentPage === 'home' && <Home />}
                    {currentPage === 'login' && <Login onLogin={() => setCurrentPage('home')} />}
                </AuthProvider>
            );
        };

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
