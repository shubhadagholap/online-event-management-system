i<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .event-card { transition: transform 0.2s; height: 100%; }
        .event-card:hover { transform: translateY(-5px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .hero-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 60px 0; margin-bottom: 40px; }
        .cursor-pointer { cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;
        const API_URL = 'http://localhost:5000/api';

        // Configure axios
        axios.interceptors.request.use(config => {
            const token = localStorage.getItem('token');
            if (token) config.headers.Authorization = `Bearer ${token}`;
            return config;
        });

        // Auth Context
        const AuthContext = createContext();
        const AuthProvider = ({ children }) => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const token = localStorage.getItem('token');
                const userData = localStorage.getItem('user');
                if (token && userData) setUser(JSON.parse(userData));
                setLoading(false);
            }, []);

            const login = async (email, password) => {
                const response = await axios.post(`${API_URL}/auth/login`, { email, password });
                const { token, user } = response.data;
                localStorage.setItem('token', token);
                localStorage.setItem('user', JSON.stringify(user));
                setUser(user);
                return response.data;
            };

            const register = async (userData) => {
                const response = await axios.post(`${API_URL}/auth/register`, userData);
                return response.data;
            };

            const logout = () => {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                setUser(null);
            };

            return (
                <AuthContext.Provider value={{ user, login, register, logout, loading }}>
                    {children}
                </AuthContext.Provider>
            );
        };

        // Navbar
        const Navbar = ({ setPage }) => {
            const { user, logout } = useContext(AuthContext);
            return (
                <nav className="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
                    <div className="container">
                        <a className="navbar-brand cursor-pointer" onClick={() => setPage('home')}>Event Management</a>
                        <button className="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                            <span className="navbar-toggler-icon"></span>
                        </button>
                        <div className="collapse navbar-collapse" id="navbarNav">
                            <ul className="navbar-nav me-auto">
                                <li className="nav-item">
                                    <a className="nav-link cursor-pointer" onClick={() => setPage('home')}>Home</a>
                                </li>
                                <li className="nav-item">
                                    <a className="nav-link cursor-pointer" onClick={() => setPage('events')}>Events</a>
                                </li>
                                {user && user.role === 'user' && (
                                    <li className="nav-item">
                                        <a className="nav-link cursor-pointer" onClick={() => setPage('my-bookings')}>My Bookings</a>
                                    </li>
                                )}
                            </ul>
                            <ul className="navbar-nav">
                                {user ? (
                                    <>
                                        <li className="nav-item">
                                            <span className="nav-link">Welcome, {user.name} ({user.role})</span>
                                        </li>
                                        <li className="nav-item">
                                            <button className="btn btn-outline-light btn-sm" onClick={() => { logout(); setPage('home'); }}>
                                                Logout
                                            </button>
                                        </li>
                                    </>
                                ) : (
                                    <>
                                        <li className="nav-item">
                                            <a className="nav-link cursor-pointer" onClick={() => setPage('login')}>Login</a>
                                        </li>
                                        <li className="nav-item">
                                            <a className="nav-link cursor-pointer" onClick={() => setPage('register')}>Register</a>
                                        </li>
                                    </>
                                )}
                            </ul>
                        </div>
                    </div>
                </nav>
            );
        };

        // Home Page
        const Home = ({ setPage }) => {
            const [events, setEvents] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');

            useEffect(() => {
                fetchEvents();
            }, []);

            const fetchEvents = async () => {
                try {
                    const response = await axios.get(`${API_URL}/events?status=upcoming`);
                    setEvents(response.data.slice(0, 6));
                    setLoading(false);
                } catch (error) {
                    console.error('Error fetching events:', error);
                    setError('Failed to load events. Make sure backend is running on port 5000.');
                    setLoading(false);
                }
            };

            return (
                <>
                    <div className="hero-section text-center">
                        <div className="container">
                            <h1 className="display-4 mb-4">Welcome to Event Management</h1>
                            <p className="lead mb-4">Discover and book amazing events happening around you</p>
                            <button className="btn btn-light btn-lg" onClick={() => setPage('events')}>Browse All Events</button>
                        </div>
                    </div>

                    <div className="container mb-5">
                        <h2 className="mb-4">Upcoming Events</h2>
                        {error && <div className="alert alert-danger">{error}</div>}
                        {loading ? (
                            <div className="text-center">Loading events...</div>
                        ) : events.length > 0 ? (
                            <div className="row">
                                {events.map((event) => (
                                    <div key={event.id} className="col-md-6 col-lg-4 mb-4">
                                        <div className="card event-card">
                                            <img 
                                                src={event.image_url || 'https://via.placeholder.com/300x200?text=Event'} 
                                                className="card-img-top" 
                                                alt={event.title}
                                                style={{height: '200px', objectFit: 'cover'}}
                                            />
                                            <div className="card-body d-flex flex-column">
                                                <div className="mb-2">
                                                    {event.category_name && (
                                                        <span className="badge bg-primary me-2">{event.category_name}</span>
                                                    )}
                                                    <span className="badge bg-success">{event.status}</span>
                                                </div>
                                                <h5 className="card-title">{event.title}</h5>
                                                <p className="card-text text-muted small">
                                                    üìÖ {new Date(event.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                                                </p>
                                                <p className="card-text text-muted small">üìç {event.location}</p>
                                                <p className="card-text flex-grow-1">{event.description?.substring(0, 100)}...</p>
                                                <div className="d-flex justify-content-between align-items-center mt-auto">
                                                    <span className="h5 mb-0 text-primary">${event.price}</span>
                                                    <button className="btn btn-primary btn-sm" onClick={() => setPage('event-' + event.id)}>View Details</button>
                                                </div>
                                                <div className="mt-2 text-muted small">
                                                    Available: {event.available_seats}/{event.capacity} seats
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="text-center text-muted">No upcoming events found</div>
                        )}
                    </div>
                </>
            );
        };

        // Events Page
        const Events = ({ setPage }) => {
            const [events, setEvents] = useState([]);
            const [categories, setCategories] = useState([]);
            const [search, setSearch] = useState('');
            const [category, setCategory] = useState('');
            const [status, setStatus] = useState('');
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetchCategories();
                fetchEvents();
            }, [search, category, status]);

            const fetchCategories = async () => {
                try {
                    const response = await axios.get(`${API_URL}/categories`);
                    setCategories(response.data);
                } catch (error) {
                    console.error('Error fetching categories:', error);
                }
            };

            const fetchEvents = async () => {
                try {
                    const params = {};
                    if (search) params.search = search;
                    if (category) params.category = category;
                    if (status) params.status = status;
                    const response = await axios.get(`${API_URL}/events`, { params });
                    setEvents(response.data);
                    setLoading(false);
                } catch (error) {
                    console.error('Error fetching events:', error);
                    setLoading(false);
                }
            };

            return (
                <div className="container mt-4 mb-5">
                    <h2 className="mb-4">All Events</h2>
                    
                    <div className="row mb-4">
                        <div className="col-md-4 mb-3">
                            <input
                                type="text"
                                className="form-control"
                                placeholder="Search events..."
                                value={search}
                                onChange={(e) => setSearch(e.target.value)}
                            />
                        </div>
                        <div className="col-md-4 mb-3">
                            <select className="form-select" value={category} onChange={(e) => setCategory(e.target.value)}>
                                <option value="">All Categories</option>
                                {categories.map((cat) => (
                                    <option key={cat.id} value={cat.id}>{cat.name}</option>
                                ))}
                            </select>
                        </div>
                        <div className="col-md-4 mb-3">
                            <select className="form-select" value={status} onChange={(e) => setStatus(e.target.value)}>
                                <option value="">All Status</option>
                                <option value="upcoming">Upcoming</option>
                                <option value="ongoing">Ongoing</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>

                    {loading ? (
                        <div className="text-center">Loading events...</div>
                    ) : events.length > 0 ? (
                        <div className="row">
                            {events.map((event) => (
                                <div key={event.id} className="col-md-6 col-lg-4 mb-4">
                                    <div className="card event-card h-100">
                                        <img 
                                            src={event.image_url || 'https://via.placeholder.com/300x200?text=Event'} 
                                            className="card-img-top" 
                                            alt={event.title}
                                            style={{height: '200px', objectFit: 'cover'}}
                                        />
                                        <div className="card-body d-flex flex-column">
                                            <h5 className="card-title">{event.title}</h5>
                                            <p className="card-text text-muted small">
                                                üìÖ {new Date(event.date).toLocaleDateString()}
                                            </p>
                                            <p className="card-text text-muted small">üìç {event.location}</p>
                                            <p className="card-text flex-grow-1">{event.description?.substring(0, 100)}...</p>
                                            <div className="d-flex justify-content-between align-items-center mt-auto">
                                                <span className="h5 mb-0 text-primary">${event.price}</span>
                                                <button className="btn btn-primary btn-sm" onClick={() => setPage('event-' + event.id)}>View Details</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="text-center text-muted">No events found</div>
                    )}
                </div>
            );
        };

        // Login Page
        const Login = ({ setPage }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);
            const { login } = useContext(AuthContext);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);
                try {
                    await login(email, password);
                    setPage('home');
                } catch (err) {
                    setError(err.response?.data?.message || 'Login failed. Check backend is running.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="container mt-5">
                    <div className="row justify-content-center">
                        <div className="col-md-6">
                            <div className="card">
                                <div className="card-body">
                                    <h2 className="text-center mb-4">Login</h2>
                                    {error && <div className="alert alert-danger">{error}</div>}
                                    <form onSubmit={handleSubmit}>
                                        <div className="mb-3">
                                            <label className="form-label">Email</label>
                                            <input
                                                type="email"
                                                className="form-control"
                                                value={email}
                                                onChange={(e) => setEmail(e.target.value)}
                                                required
                                            />
                                        </div>
                                        <div className="mb-3">
                                            <label className="form-label">Password</label>
                                            <input
                                                type="password"
                                                className="form-control"
                                                value={password}
                                                onChange={(e) => setPassword(e.target.value)}
                                                required
                                            />
                                        </div>
                                        <button type="submit" className="btn btn-primary w-100" disabled={loading}>
                                            {loading ? 'Logging in...' : 'Login'}
                                        </button>
                                    </form>
                                    <div className="text-center mt-3">
                                        Don't have an account? <a href="#" onClick={() => setPage('register')}>Register here</a>
                                    </div>
                                    <div className="mt-3 text-muted small">
                                        <strong>Test Credentials:</strong><br/>
                                        Admin: admin@example.com / admin123<br/>
                                        Organizer: organizer@example.com / organizer123<br/>
                                        User: user@example.com / user123
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Register Page
        const Register = ({ setPage }) => {
            const [formData, setFormData] = useState({
                name: '', email: '', password: '', confirmPassword: '', phone: '', role: 'user'
            });
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [loading, setLoading] = useState(false);
            const { register } = useContext(AuthContext);

            const handleChange = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setSuccess('');

                if (formData.password !== formData.confirmPassword) {
                    setError('Passwords do not match');
                    return;
                }

                setLoading(true);
                try {
                    await register({
                        name: formData.name,
                        email: formData.email,
                        password: formData.password,
                        phone: formData.phone,
                        role: formData.role
                    });
                    setSuccess('Registration successful! Please login.');
                    setTimeout(() => setPage('login'), 2000);
                } catch (err) {
                    setError(err.response?.data?.message || 'Registration failed');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="container mt-5 mb-5">
                    <div className="row justify-content-center">
                        <div className="col-md-6">
                            <div className="card">
                                <div className="card-body">
                                    <h2 className="text-center mb-4">Register</h2>
                                    {error && <div className="alert alert-danger">{error}</div>}
                                    {success && <div className="alert alert-success">{success}</div>}
                                    <form onSubmit={handleSubmit}>
                                        <div className="mb-3">
                                            <label className="form-label">Name</label>
                                            <input type="text" className="form-control" name="name" value={formData.name} onChange={handleChange} required />
                                        </div>
                                        <div className="mb-3">
                                            <label className="form-label">Email</label>
                                            <input type="email" className="form-control" name="email" value={formData.email} onChange={handleChange} required />
                                        </div>
                                        <div className="mb-3">
                                            <label className="form-label">Phone</label>
                                            <input type="tel" className="form-control" name="phone" value={formData.phone} onChange={handleChange} />
                                        </div>
                                        <div className="mb-3">
                                            <label className="form-label">Role</label>
                                            <select className="form-select" name="role" value={formData.role} onChange={handleChange}>
                                                <option value="user">User (Attendee)</option>
                                                <option value="organizer">Organizer</option>
                                            </select>
                                        </div>
                                        <div className="mb-3">
                                            <label className="form-label">Password</label>
                                            <input type="password" className="form-control" name="password" value={formData.password} onChange={handleChange} required />
                                        </div>
                                        <div className="mb-3">
                                            <label className="form-label">Confirm Password</label>
                                            <input type="password" className="form-control" name="confirmPassword" value={formData.confirmPassword} onChange={handleChange} required />
                                        </div>
                                        <button type="submit" className="btn btn-primary w-100" disabled={loading}>
                                            {loading ? 'Registering...' : 'Register'}
                                        </button>
                                    </form>
                                    <div className="text-center mt-3">
                                        Already have an account? <a href="#" onClick={() => setPage('login')}>Login here</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App
        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');

            return (
                <AuthProvider>
                    <Navbar setPage={setCurrentPage} />
                    {currentPage === 'home' && <Home setPage={setCurrentPage} />}
                    {currentPage === 'events' && <Events setPage={setCurrentPage} />}
                    {currentPage === 'login' && <Login setPage={setCurrentPage} />}
                    {currentPage === 'register' && <Register setPage={setCurrentPage} />}
                </AuthProvider>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
